document.addEventListener('DOMContentLoaded', function() {
  // DOM Elements
  const addUserBtn = document.getElementById('addUserBtn');
  const userModal = new bootstrap.Modal(document.getElementById('userModal'));
  const userForm = document.getElementById('userForm');
  const userTableBody = document.getElementById('userTableBody');
  const modalTitle = document.getElementById('modalTitle');

  // Sample Data (Replace with actual API calls in production)
  let users = [];

  let currentEditingId = null;

  // Initialize the page
  function init() {
    renderUserTable();
    setupEventListeners();
  }

  // Render user table
  function renderUserTable() {
    userTableBody.innerHTML = '';
    
    if (users.length === 0) {
      userTableBody.innerHTML = `
        <tr>
          <td colspan="4" class="text-center">No users found</td>
        </tr>
      `;
      return;
    }

    users.forEach(user => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${user.name}</td>
        <td>${user.email}</td>
        <td><span class="role-badge ${user.role}">${user.role.charAt(0).toUpperCase() + user.role.slice(1)}</span></td>
        <td>
          <button class="action-btn edit-btn" data-id="${user.id}">Edit</button>
          <button class="action-btn delete-btn" data-id="${user.id}">Delete</button>
        </td>
      `;
      userTableBody.appendChild(row);
    });

    // Add event listeners to action buttons
    document.querySelectorAll('.edit-btn').forEach(btn => {
      btn.addEventListener('click', handleEditUser);
    });
    
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', handleDeleteUser);
    });
  }

  // Setup event listeners
  function setupEventListeners() {
    // Add User button
    addUserBtn.addEventListener('click', () => {
      currentEditingId = null;
      modalTitle.textContent = 'Add New User';
      userForm.reset();
      userModal.show();
    });

    // Form submission
    userForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const role = document.getElementById('role').value;
      
      if (!name || !email || !role) {
        alert('Please fill in all fields');
        return;
      }

      if (!validateEmail(email)) {
        alert('Please enter a valid email address');
        return;
      }

      const userData = { name, email, role };
      
      if (currentEditingId !== null) {
        // Update existing user
        updateUser(currentEditingId, userData);
      } else {
        // Add new user
        addUser(userData);
      }
      
      userModal.hide();
    });
  }

  // Handle edit user
  function handleEditUser(e) {
    const userId = parseInt(e.currentTarget.getAttribute('data-id'));
    const userToEdit = users.find(user => user.id === userId);
    
    if (userToEdit) {
      currentEditingId = userId;
      modalTitle.textContent = 'Edit User';
      document.getElementById('name').value = userToEdit.name;
      document.getElementById('email').value = userToEdit.email;
      document.getElementById('role').value = userToEdit.role;
      userModal.show();
    }
  }

  // Handle delete user
  function handleDeleteUser(e) {
    const userId = parseInt(e.currentTarget.getAttribute('data-id'));
    
    if (confirm('Are you sure you want to delete this user?')) {
      deleteUser(userId);
    }
  }

  // Add new user
  function addUser(userData) {
    const newUserId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
    const newUser = { id: newUserId, ...userData };
    users.push(newUser);
    renderUserTable();
  }

  // Update existing user
  function updateUser(userId, userData) {
    const userIndex = users.findIndex(user => user.id === userId);
    if (userIndex !== -1) {
      users[userIndex] = { ...users[userIndex], ...userData };
      renderUserTable();
    }
  }

  // Delete user
  function deleteUser(userId) {
    users = users.filter(user => user.id !== userId);
    renderUserTable();
  }

  // Helper function to validate email
  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  // Initialize the application
  init();
});